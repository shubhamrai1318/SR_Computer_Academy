<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SR Computer Academy â€” Student Dashboard</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">

  <style>
    :root{
      --teal-1: #0ea5a4;    /* primary */
      --navy-1: #093b66;    /* deep accent */
      --glass: rgba(255,255,255,0.08);
      --card: rgba(255,255,255,0.95);
      --muted: #6b7280;
      --radius: 14px;
      --shadow: 0 10px 30px rgba(2,6,23,0.12);
    }

    [data-theme="dark"]{
      --teal-1: #1fb6b0;
      --navy-1: #0b2540;
      --glass: rgba(255,255,255,0.04);
      --card: rgba(18,18,20,0.85);
      --muted: #9aa3b2;
      --shadow: 0 12px 34px rgba(0,0,0,0.6);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Poppins",sans-serif;
      background:linear-gradient(135deg,#b9f6f4 0%, #8bd5ff 50%, #84b6ff 100%);
      -webkit-font-smoothing:antialiased;
      color:#12202b;
      transition: background .3s ease,color .3s ease;
    }

    [data-theme="dark"] body{
      background: linear-gradient(135deg,#07202a 0%, #08324b 60%, #0b5f7a 100%);
      color:#e6eef4;
    }

    /* Layout */
    .wrap{
      max-width:1200px;
      margin:22px auto;
      padding:18px;
      display:grid;
      grid-template-columns: 250px 1fr;
      gap:18px;
    }

    /* Sidebar */
    .sidebar{
      position:relative;
      border-radius:var(--radius);
      background:var(--glass);
      padding:22px 16px;
      height:calc(100vh - 44px);
      box-shadow:var(--shadow);
      backdrop-filter: blur(8px);
      display:flex;
      flex-direction:column;
      gap:12px;
      transition: transform .28s ease, left .28s ease;
    }

    .brand {
      display:flex;
      gap:12px;
      align-items:center;
      margin-bottom:4px;
    }
    .logo{
      width:52px;height:52px;border-radius:12px;
      background:linear-gradient(135deg,var(--teal-1),var(--navy-1));
      display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:18px;
      box-shadow:0 8px 20px rgba(9,59,102,0.12);
    }
    .brand .title{font-weight:700}
    .brand .sub{font-size:12px;color:var(--muted)}

    .side-actions{ display:flex; flex-direction:column; gap:8px; margin-top:6px}
    .side-btn{
      display:flex;gap:10px;align-items:center;padding:12px;border-radius:10px;background:transparent;border:none;color:inherit;
      cursor:pointer;font-weight:600;transition:all .18s;
    }
    .side-btn:hover{ transform:translateX(6px); background:rgba(255,255,255,0.03) }

    .logout{ margin-top:auto; background:transparent; border-radius:10px; color:#fff; padding:12px; font-weight:700; background:#e04646; }
    .logout:hover{ filter:brightness(.95) }

    /* Theme toggle small */
    .theme-row{ margin-top:8px; display:flex; gap:8px; align-items:center; justify-content:center }
    .theme-toggle{
      padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,0.06); background:transparent; cursor:pointer; font-weight:600;
    }

    /* Main content */
    .main {
      border-radius:18px;
      background:var(--card);
      padding:18px;
      box-shadow:var(--shadow);
      min-height: calc(100vh - 44px);
      overflow:auto;
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom:16px;
    }

    .welcome {
      display:flex;
      gap:12px;
      align-items:center;
    }

    .profile-mini{
      display:flex; gap:12px; align-items:center;
      background:linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.02));
      padding:10px;border-radius:12px;
    }

    .avatar{
      width:56px;height:56px;border-radius:12px;overflow:hidden;border:2px solid rgba(255,255,255,0.08);
      display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--teal-1),var(--navy-1)); color:#fff;
    }
    .avatar img{width:100%;height:100%;object-fit:cover}

    .welcome h1{font-size:18px;margin:0}
    .welcome small{display:block;color:var(--muted);font-size:13px;margin-top:4px}

    .controls { display:flex; gap:8px; align-items:center; }

    .icon-btn{
      background:transparent;border:1px solid rgba(0,0,0,0.06); padding:10px;border-radius:10px;cursor:pointer;
      display:inline-flex;align-items:center;justify-content:center; gap:8px; font-weight:600;
    }
    [data-theme="dark"] .icon-btn{ border:1px solid rgba(255,255,255,0.04) }

    /* Grid cards */
    .grid{
      display:grid;
      grid-template-columns: 1fr 320px;
      gap:16px;
      align-items:start;
    }

    /* Left column area (cards) */
    .left-col{
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .cards{
      display:grid;
      grid-template-columns: repeat(auto-fit,minmax(160px,1fr));
      gap:12px;
    }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.96), rgba(255,255,255,0.9));
      border-radius:12px;padding:14px; box-shadow: 0 8px 24px rgba(9,59,102,0.06);
      display:flex; flex-direction:column; gap:10px;
    }
    [data-theme="dark"] .card{ background: rgba(255,255,255,0.03) }

    .card h4{ margin:0; font-size:12px; color:var(--teal-1); font-weight:800; letter-spacing:0.6px }
    .card .big{ font-size:22px; font-weight:800 }

    /* Progress ring container */
    .progress-wrap{ display:flex; gap:14px; align-items:center }
    .ring{ width:110px; height:110px; display:grid; place-items:center; position:relative }
    .ring svg{ transform: rotate(-90deg) }
    .ring .ring-label{ position:absolute; text-align:center; font-weight:800 }

    /* Notifications / Recent updates list */
    .notifications{
      display:flex;flex-direction:column;gap:8px;
    }
    .note{
      display:flex;gap:10px;align-items:flex-start;padding:10px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.97), rgba(255,255,255,0.92));
      border-left:4px solid rgba(0,0,0,0.05);
    }
    .note .time{ font-size:12px;color:var(--muted) }
    [data-theme="dark"] .note{ background: rgba(255,255,255,0.02) }

    /* Right column */
    .right-col{
      display:flex;flex-direction:column;gap:12px;
      position:relative;
    }

    .panel{
      border-radius:12px;padding:14px;background:linear-gradient(180deg, rgba(255,255,255,0.98), rgba(255,255,255,0.94));
      box-shadow:var(--shadow);
    }
    [data-theme="dark"] .panel{ background: rgba(255,255,255,0.02) }

    .panel h3{margin:0 0 8px 0}
    .small-muted{ font-size:13px;color:var(--muted) }

    /* Edit profile slide panel */
    .edit-panel {
      position:fixed;
      right:-420px; top:0; height:100vh; width:400px;
      background:var(--card);
      box-shadow: -12px 20px 50px rgba(0,0,0,0.18);
      transition:right .35s ease;
      z-index:1600;
      padding:22px;
      overflow:auto;
    }
    .edit-panel.open{ right:20px }

    .form-row{ display:flex; flex-direction:column; gap:8px; margin-bottom:12px }
    .form-row label{ font-weight:700; font-size:13px; color:var(--navy-1) }
    .form-row input{ padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06) }
    [data-theme="dark"] .form-row input{ border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit }

    .save-btn{ display:inline-block; padding:10px 14px; border-radius:10px; background:linear-gradient(90deg,var(--teal-1),var(--navy-1)); color:#fff; border:none; cursor:pointer; font-weight:800 }

    /* Footer */
    footer{ margin-top:18px; text-align:center; color:var(--muted); font-size:13px; }

    /* Responsive */
    @media(max-width: 980px){
      .wrap{ grid-template-columns: 1fr; padding:10px }
      .sidebar{ position:fixed; left:-280px; top:12px; height:calc(100vh - 24px); z-index:1500 }
      .sidebar.active{ left:12px }
      .grid{ grid-template-columns: 1fr; }
      .right-col{ order:2 }
      .left-col{ order:1 }
      .edit-panel{ width:100%; right:-100%; }
      .edit-panel.open{ right:0 }
    }

    /* small helpers */
    .muted{ color:var(--muted) }
    .center{ display:flex; align-items:center; justify-content:center }
  </style>
</head>
<body>

  <div class="wrap">
    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="brand">
        <div class="logo">SR</div>
        <div>
          <div class="title">SRCA Portal</div>
          <div class="sub">Student Dashboard</div>
        </div>
      </div>

      <div class="side-actions">
        <button class="side-btn" id="btnHome"><i class="ri-dashboard-line"></i> Dashboard</button>
        <button class="side-btn" id="btnEdit"><i class="ri-user-settings-line"></i> Edit Profile</button>
        <button class="side-btn" id="btnNotifications"><i class="ri-notification-line"></i> Notifications</button>
        <button class="side-btn" id="btnHelp"><i class="ri-question-line"></i> Help</button>
      </div>

      <div class="theme-row">
        <button class="theme-toggle" id="themeToggle"><i class="ri-contrast-2-line"></i> Theme</button>
      </div>

      <button class="logout" id="logoutBtn"><i class="ri-logout-circle-r-line"></i> Logout</button>
    </aside>

    <!-- MAIN -->
    <main class="main" id="main">
      <div class="topbar">
        <div class="welcome">
          <div class="profile-mini">
            <div class="avatar" id="topAvatar" title="Profile photo"><!-- avatar image injected by JS --></div>
            <div>
              <h1 id="topName">Welcome, Student</h1>
              <small id="topCourse" class="muted">Course â€¢ Batch</small>
            </div>
          </div>
        </div>

        <div class="controls">
          <button class="icon-btn" id="openSidebar"><i class="ri-menu-line"></i></button>
          <button class="icon-btn" id="openEdit"><i class="ri-pencil-line"></i> Edit</button>
        </div>
      </div>

      <div class="grid">
        <!-- Left column -->
        <section class="left-col">
          <div class="cards">
            <div class="card">
              <h4>Total Fees</h4>
              <div class="big">â‚¹ <span id="studentfee">0</span></div>
            </div>

            <div class="card">
              <h4>Amount Paid</h4>
              <div class="big">â‚¹ <span id="studentpaid">0</span></div>
            </div>

            <div class="card">
              <h4>Amount Due</h4>
              <div class="big">â‚¹ <span id="studentdue">0</span></div>
            </div>
          </div>

          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <h4>Fee Payment Progress</h4>
                <div class="muted small" style="margin-top:6px">Shows percentage of fees paid</div>
              </div>
              <div class="progress-wrap">
                <div class="ring" aria-hidden>
                  <!-- SVG ring created by JS -->
                </div>
                <div style="min-width:120px">
                  <div style="font-size:14px;font-weight:700" id="progressText">0% paid</div>
                  <div class="muted" style="margin-top:6px">Target: Full course fee</div>
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <h4>Recent Notifications</h4>
            <div id="notifications" class="notifications">
              <!-- JS injects notifications -->
            </div>
          </div>
        </section>

        <!-- Right column -->
        <aside class="right-col">
          <div class="panel">
            <h3>Profile</h3>
            <div style="display:flex;gap:12px;align-items:center;margin-top:8px">
              <div class="avatar" id="profileAvatarLarge"></div>
              <div>
                <div style="font-weight:800" id="displayName">Student Name</div>
                <div class="muted" id="displayUsername">@username</div>
                <div style="margin-top:8px" class="small-muted" id="displayContact">Contact: â€”</div>
              </div>
            </div>
          </div>

          <div class="panel">
            <h3>Course Details</h3>
            <div style="margin-top:8px">
              <div class="small-muted">Course: <strong id="displayCourse">â€”</strong></div>
              <div class="small-muted">Batch: <strong id="displayBatch">â€”</strong></div>
              <div class="small-muted" style="margin-top:6px">Admission Date: <strong id="displayDOA">â€”</strong></div>
            </div>
          </div>

          <div class="panel">
            <h3>Quick Actions</h3>
            <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap">
              <button class="icon-btn" id="actionPay"><i class="ri-wallet-3-line"></i> Pay Fees</button>
              <button class="icon-btn" id="actionContact"><i class="ri-phone-line"></i> Contact Office</button>
              <button class="icon-btn" id="actionDocs"><i class="ri-folder-2-line"></i> Download Receipt</button>
            </div>
          </div>
        </aside>
      </div>

      <footer>
        Â© <strong>SR Computer Academy</strong> â€” Student Dashboard
      </footer>
    </main>
  </div>

  <!-- EDIT PROFILE SLIDE PANEL -->
  <aside class="edit-panel" id="editPanel" aria-hidden>
    <h2 style="margin-top:0">Edit Profile</h2>

    <div style="display:flex;gap:12px;align-items:center;margin-bottom:12px">
      <div class="avatar" id="editAvatarPreview"></div>
      <div>
        <label style="font-weight:700;font-size:13px">Upload Photo</label>
        <input id="avatarInput" type="file" accept="image/*" style="margin-top:8px" />
        <div class="muted small" style="margin-top:8px">Max 2 MB â€” optional</div>
      </div>
    </div>

    <div class="form-row">
      <label for="inputFullname">Full Name</label>
      <input id="inputFullname" type="text" placeholder="Your full name" />
    </div>

    <div class="form-row">
      <label for="inputUsername">Username</label>
      <input id="inputUsername" type="text" placeholder="username" />
    </div>

    <div class="form-row">
      <label for="inputContact">Contact</label>
      <input id="inputContact" type="text" placeholder="+91 xxxxxxxxxx" />
    </div>

    <div class="form-row">
      <label for="inputCourse">Course</label>
      <input id="inputCourse" type="text" placeholder="Course name" />
    </div>

    <div class="form-row">
      <label for="inputBatch">Batch</label>
      <input id="inputBatch" type="text" placeholder="Batch" />
    </div>

    <div class="form-row">
      <label for="inputDOA">Admission Date</label>
      <input id="inputDOA" type="date" />
    </div>

    <div style="display:flex;gap:10px;margin-top:8px">
      <button class="save-btn" id="saveProfileBtn">Save</button>
      <button class="icon-btn" id="closeEdit"><i class="ri-close-line"></i> Close</button>
    </div>

    <div style="margin-top:16px" class="muted small">Notes: Changes are saved locally (localStorage). If your system uses a server, connect the save handler to your API/Google Script.</div>
  </aside>

  <script>
    // Helper: query elements
    const $ = sel => document.querySelector(sel);
    const $$ = sel => document.querySelectorAll(sel);

    // Get stored student or redirect like before
    let student = JSON.parse(localStorage.getItem('studentData')) || null;

    // If no student found, keep behavior consistent: redirect to index.html
    if(!student){
      // don't immediately redirect when user might be testing â€” but previous logic redirected
      // We'll redirect to index.html to keep original behavior
      window.location.href = "index.html";
    }

    // DOM nodes
    const topName = $('#topName');
    const topCourse = $('#topCourse');
    const topAvatar = $('#topAvatar');
    const profileAvatarLarge = $('#profileAvatarLarge');
    const displayName = $('#displayName');
    const displayUsername = $('#displayUsername');
    const displayContact = $('#displayContact');
    const displayCourse = $('#displayCourse');
    const displayBatch = $('#displayBatch');
    const displayDOA = $('#displayDOA');

    const studentFeeEl = $('#studentfee');
    const studentPaidEl = $('#studentpaid');
    const studentDueEl = $('#studentdue');
    const progressText = $('#progressText');
    const ringContainer = document.querySelector('.ring');
    const notificationsEl = $('#notifications');

    // Edit panel elements
    const editPanel = $('#editPanel');
    const btnEdit = $('#btnEdit');
    const openEdit = $('#openEdit');
    const closeEdit = $('#closeEdit');
    const avatarInput = $('#avatarInput');
    const editAvatarPreview = $('#editAvatarPreview');

    const inputFullname = $('#inputFullname');
    const inputUsername = $('#inputUsername');
    const inputContact = $('#inputContact');
    const inputCourse = $('#inputCourse');
    const inputBatch = $('#inputBatch');
    const inputDOA = $('#inputDOA');
    const saveProfileBtn = $('#saveProfileBtn');

    const sidebar = $('#sidebar');
    const openSidebar = $('#openSidebar');
    const toggleBtn = document.createElement('button');

    // Theme
    const themeToggle = $('#themeToggle');
    const storedTheme = localStorage.getItem('sr_theme');
    if(storedTheme) document.body.dataset.theme = storedTheme;

    // Populate UI from student object
    function populateUI(){
      if(!student) return;
      const name = student.name || student.fullname || 'Student';
      const username = student.username || 'username';
      const course = student.course || 'â€”';
      const batch = student.batch || 'â€”';
      const contact = student.contact || 'â€”';
      const doa = student.add_date || student.doa || 'â€”';
      const fee = student.course_fee || '0';
      const paid = student.paid || '0';
      const due = student.due || String(Math.max(0, (parseFloat(fee) || 0) - (parseFloat(paid)||0)));

      topName.textContent = `Hi, ${name}`;
      topCourse.textContent = `${course} â€¢ ${batch}`;
      displayName.textContent = name;
      displayUsername.textContent = `@${username}`;
      displayContact.textContent = `Contact: ${contact}`;
      displayCourse.textContent = course;
      displayBatch.textContent = batch;
      displayDOA.textContent = doa;

      studentFeeEl.textContent = fee;
      studentPaidEl.textContent = paid;
      studentDueEl.textContent = due;
      const percent = (parseFloat(fee) > 0) ? Math.round(((parseFloat(paid)||0)/parseFloat(fee))*100) : 0;
      progressText.textContent = `${Math.min(percent,100)}% paid`;

      // Avatar: priority -> localStorage avatar image, then student.avatar, else placeholder initials
      const avatarData = localStorage.getItem('sr_avatar') || student.avatar || '';
      setAvatar(topAvatar, avatarData, name);
      setAvatar(profileAvatarLarge, avatarData, name);
      setAvatar(editAvatarPreview, avatarData, name);

      // Create ring
      createRing(Math.min(Math.max(percent,0),100));
    }

    // Set avatar element
    function setAvatar(el, dataUrl, name){
      el.innerHTML = '';
      if(dataUrl){
        const img = document.createElement('img'); img.src = dataUrl; img.alt = name;
        el.appendChild(img);
      } else {
        const initials = (name||'S').split(' ').map(s=>s[0]).slice(0,2).join('').toUpperCase();
        el.style.background = `linear-gradient(135deg,var(--teal-1),var(--navy-1))`;
        el.textContent = initials;
        el.style.color = '#fff';
        el.style.fontWeight = 800;
      }
    }

    // Create circular progress ring (SVG) and animate
    function createRing(percent){
      ringContainer.innerHTML = '';
      const size = 110;
      const stroke = 10;
      const radius = (size - stroke)/2;
      const circumference = 2 * Math.PI * radius;

      const svgNS = 'http://www.w3.org/2000/svg';
      const svg = document.createElementNS(svgNS,'svg');
      svg.setAttribute('width', size);
      svg.setAttribute('height', size);

      const bg = document.createElementNS(svgNS,'circle');
      bg.setAttribute('cx', size/2); bg.setAttribute('cy', size/2);
      bg.setAttribute('r', radius);
      bg.setAttribute('stroke', '#f0f0f0');
      bg.setAttribute('stroke-width', stroke);
      bg.setAttribute('fill','none');

      const fg = document.createElementNS(svgNS,'circle');
      fg.setAttribute('cx', size/2); fg.setAttribute('cy', size/2);
      fg.setAttribute('r', radius);
      fg.setAttribute('stroke', 'url(#grad1)');
      fg.setAttribute('stroke-width', stroke);
      fg.setAttribute('stroke-linecap','round');
      fg.setAttribute('fill','none');
      fg.setAttribute('stroke-dasharray', circumference);
      fg.setAttribute('stroke-dashoffset', circumference);

      // gradient defs
      const defs = document.createElementNS(svgNS,'defs');
      const grad = document.createElementNS(svgNS,'linearGradient');
      grad.setAttribute('id','grad1');
      grad.setAttribute('x1','0%'); grad.setAttribute('y1','0%'); grad.setAttribute('x2','100%'); grad.setAttribute('y2','0%');
      const stop1 = document.createElementNS(svgNS,'stop'); stop1.setAttribute('offset','0%'); stop1.setAttribute('stop-color','#2ecc71');
      const stop2 = document.createElementNS(svgNS,'stop'); stop2.setAttribute('offset','100%'); stop2.setAttribute('stop-color','#27ae60');
      grad.appendChild(stop1); grad.appendChild(stop2);
      defs.appendChild(grad);

      svg.appendChild(defs);
      svg.appendChild(bg);
      svg.appendChild(fg);
      ringContainer.appendChild(svg);

      // label
      const label = document.createElement('div');
      label.className = 'ring-label';
      label.innerHTML = `<div style="font-size:14px;color:var(--muted)">Paid</div><div style="font-size:18px;font-weight:800">${percent}%</div>`;
      ringContainer.appendChild(label);

      // Animate
      setTimeout(()=> {
        const offset = circumference - (percent/100) * circumference;
        fg.style.transition = 'stroke-dashoffset 1s ease-out';
        fg.style.strokeDashoffset = offset;
      }, 50);
    }

    // Example notifications (could be loaded from server later)
    function loadNotifications(){
      // If student object has notifications, show them; otherwise a few defaults
      const notes = (student && student.notifications) ? student.notifications.slice().reverse() : [
        { text: "Welcome to SR Academy â€” your course begins soon", time: "2 days ago" },
        { text: "Library timings updated: Monâ€“Sat 9:00â€“18:00", time: "5 days ago" },
        { text: "Installments for next month due â€” contact office", time: "1 week ago" }
      ];

      notificationsEl.innerHTML = '';
      notes.forEach(n => {
        const el = document.createElement('div'); el.className='note';
        el.innerHTML = `<div style="width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--teal-1),var(--navy-1));display:flex;align-items:center;justify-content:center;color:white"><i class="ri-notification-3-line"></i></div>
                        <div style="flex:1"><div style="font-weight:700">${n.text}</div><div class="time muted">${n.time}</div></div>`;
        notificationsEl.appendChild(el);
      });
    }

    // Open/close edit panel
    function openEditPanel(){ editPanel.classList.add('open'); editPanel.setAttribute('aria-hidden','false'); populateEditForm(); }
    function closeEditPanel(){ editPanel.classList.remove('open'); editPanel.setAttribute('aria-hidden','true'); }

    // Populate edit form with current data
    function populateEditForm(){
      if(!student) return;
      inputFullname.value = student.name || '';
      inputUsername.value = student.username || '';
      inputContact.value = student.contact || '';
      inputCourse.value = student.course || '';
      inputBatch.value = student.batch || '';
      inputDOA.value = student.add_date || '';
    }

    // Avatar upload handling (store in localStorage as data URL)
    avatarInput.addEventListener('change', (e)=>{
      const f = e.target.files[0];
      if(!f) return;
      if(f.size > 2 * 1024 * 1024){ alert('Image too large â€” max 2MB'); return; }
      const reader = new FileReader();
      reader.onload = () => {
        localStorage.setItem('sr_avatar', reader.result);
        setAvatar(topAvatar, reader.result, student.name);
        setAvatar(profileAvatarLarge, reader.result, student.name);
        setAvatar(editAvatarPreview, reader.result, student.name);
      };
      reader.readAsDataURL(f);
    });

    // Save profile
    saveProfileBtn.addEventListener('click', ()=>{
      const updated = {
        ...student,
        name: inputFullname.value.trim() || student.name,
        username: inputUsername.value.trim() || student.username,
        contact: inputContact.value.trim() || student.contact,
        course: inputCourse.value.trim() || student.course,
        batch: inputBatch.value.trim() || student.batch,
        add_date: inputDOA.value || student.add_date
      };
      student = updated;
      localStorage.setItem('studentData', JSON.stringify(updated));
      populateUI();
      closeEditPanel();
      // Also add a small notification to list
      const note = { text: "Your profile was updated", time: "just now" };
      student.notifications = student.notifications || [];
      student.notifications.push(note);
      localStorage.setItem('studentData', JSON.stringify(student));
      loadNotifications();
    });

    // Theme toggle
    themeToggle.addEventListener('click', ()=>{
      const current = document.body.dataset.theme === 'dark' ? '' : 'dark';
      document.body.dataset.theme = current;
      localStorage.setItem('sr_theme', current);
    });

    // Sidebar mobile open
    openSidebar.addEventListener('click', ()=> {
      sidebar.classList.toggle('active');
    });
    $('#btnEdit').addEventListener('click', openEditPanel);
    openEdit.addEventListener('click', openEditPanel);
    closeEdit.addEventListener('click', closeEditPanel);
    $('#btnNotifications').addEventListener('click', ()=> {
      // focus notification area
      notificationsEl.scrollIntoView({behavior:'smooth', block:'start'});
    });

    // Quick actions (simulated)
    $('#actionContact').addEventListener('click', ()=> {
      alert('Call or WhatsApp on: +91 8808616262');
    });
    $('#actionPay').addEventListener('click', ()=> {
      alert('Will be Implemented Soon.');
    });
    $('#actionDocs').addEventListener('click', ()=> {
      alert('Working on It');
    });

    // Logout (mirror previous behaviour)
    $('#logoutBtn').addEventListener('click', ()=> {
      // Optionally clear student data from localStorage and redirect:
      localStorage.removeItem('studentData');
      // keep avatar if you want, comment out next line to keep avatar after logout:
      // localStorage.removeItem('sr_avatar');
      window.location.href = 'index.html';
    });

    // Populate UI on load
    populateUI();
    loadNotifications();

    // Make edit panel accessible via keyboard (Escape to close)
    document.addEventListener('keydown', (e)=>{
      if(e.key === 'Escape') {
        if(editPanel.classList.contains('open')) closeEditPanel();
        if(sidebar.classList.contains('active')) sidebar.classList.remove('active');
      }
    });

    // Safety: ensure numeric values
    // If student has numeric fees/pays as strings, keep numeric conversions safe for progress ring update when data changes
    // If you later update amounts via server, call populateUI() again to refresh.
  </script>
</body>
</html>
